; /* /bitrix/js/pull/protobuf/protobuf.min.min.js?156759068320692*/
; /* /bitrix/js/pull/protobuf/model.min.js?156759068313978*/
; /* /bitrix/js/pull/client/pull.client.min.js?156759068339145*/

; /* Start:"a:4:{s:4:"full";s:60:"/bitrix/js/pull/protobuf/protobuf.min.min.js?156759068320692";s:6:"source";s:40:"/bitrix/js/pull/protobuf/protobuf.min.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
!function(t,r){"use strict";!function(r,e,n){function i(t){var n=e[t];return n||r[t][0].call(n=e[t]={exports:{}},i,n,n.exports),n.exports}var o=t.protobuf=i(n[0]);"function"==typeof define&&define.amd&&define(["long"],function(t){return t&&t.isLong&&(o.util.Long=t,o.configure()),o}),"object"==typeof module&&module&&module.exports&&(module.exports=o)}({1:[function(t,r){function e(t,r){for(var e=Array(arguments.length-1),n=0,i=2,o=!0;i<arguments.length;)e[n++]=arguments[i++];return new Promise(function(i,s){e[n]=function(t){if(o)if(o=!1,t)s(t);else{for(var r=Array(arguments.length-1),e=0;e<r.length;)r[e++]=arguments[e];i.apply(null,r)}};try{t.apply(r||null,e)}catch(t){o&&(o=!1,s(t))}})}r.exports=e},{}],2:[function(t,e,n){var i=n;i.length=function(t){var r=t.length;if(!r)return 0;for(var e=0;--r%4>1&&"="===t.charAt(r);)++e;return Math.ceil(3*t.length)/4-e};for(var o=Array(64),s=Array(123),u=0;u<64;)s[o[u]=u<26?u+65:u<52?u+71:u<62?u-4:u-59|43]=u++;i.encode=function(t,r,e){for(var n,i=null,s=[],u=0,f=0;r<e;){var h=t[r++];switch(f){case 0:s[u++]=o[h>>2],n=(3&h)<<4,f=1;break;case 1:s[u++]=o[n|h>>4],n=(15&h)<<2,f=2;break;case 2:s[u++]=o[n|h>>6],s[u++]=o[63&h],f=0}u>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),u=0)}return f&&(s[u++]=o[n],s[u++]=61,1===f&&(s[u++]=61)),i?(u&&i.push(String.fromCharCode.apply(String,s.slice(0,u))),i.join("")):String.fromCharCode.apply(String,s.slice(0,u))};i.decode=function(t,e,n){for(var i,o=n,u=0,f=0;f<t.length;){var h=t.charCodeAt(f++);if(61===h&&u>1)break;if((h=s[h])===r)throw Error("invalid encoding");switch(u){case 0:i=h,u=1;break;case 1:e[n++]=i<<2|(48&h)>>4,i=h,u=2;break;case 2:e[n++]=(15&i)<<4|(60&h)>>2,i=h,u=3;break;case 3:e[n++]=(3&i)<<6|h,u=0}}if(1===u)throw Error("invalid encoding");return n-o},i.test=function(t){return/^(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(t)}},{}],3:[function(t,e){function n(){this.a={}}e.exports=n,n.prototype.on=function(t,r,e){return(this.a[t]||(this.a[t]=[])).push({fn:r,ctx:e||this}),this},n.prototype.off=function(t,e){if(t===r)this.a={};else if(e===r)this.a[t]=[];else for(var n=this.a[t],i=0;i<n.length;)n[i].fn===e?n.splice(i,1):++i;return this},n.prototype.emit=function(t){var r=this.a[t];if(r){for(var e=[],n=1;n<arguments.length;)e.push(arguments[n++]);for(n=0;n<r.length;)r[n].fn.apply(r[n++].ctx,e)}return this}},{}],4:[function(t,r){function e(t){return"undefined"!=typeof Float32Array?function(){function r(t,r,e){o[0]=t,r[e]=s[0],r[e+1]=s[1],r[e+2]=s[2],r[e+3]=s[3]}function e(t,r,e){o[0]=t,r[e]=s[3],r[e+1]=s[2],r[e+2]=s[1],r[e+3]=s[0]}function n(t,r){return s[0]=t[r],s[1]=t[r+1],s[2]=t[r+2],s[3]=t[r+3],o[0]}function i(t,r){return s[3]=t[r],s[2]=t[r+1],s[1]=t[r+2],s[0]=t[r+3],o[0]}var o=new Float32Array([-0]),s=new Uint8Array(o.buffer),u=128===s[3];t.writeFloatLE=u?r:e,t.writeFloatBE=u?e:r,t.readFloatLE=u?n:i,t.readFloatBE=u?i:n}():function(){function r(t,r,e,n){var i=r<0?1:0;if(i&&(r=-r),0===r)t(1/r>0?0:2147483648,e,n);else if(isNaN(r))t(2143289344,e,n);else if(r>3.4028234663852886e38)t((i<<31|2139095040)>>>0,e,n);else if(r<1.1754943508222875e-38)t((i<<31|Math.round(r/1.401298464324817e-45))>>>0,e,n);else{var o=Math.floor(Math.log(r)/Math.LN2),s=8388607&Math.round(r*Math.pow(2,-o)*8388608);t((i<<31|o+127<<23|s)>>>0,e,n)}}function e(t,r,e){var n=t(r,e),i=2*(n>>31)+1,o=n>>>23&255,s=8388607&n;return 255===o?s?NaN:i*(1/0):0===o?1.401298464324817e-45*i*s:i*Math.pow(2,o-150)*(s+8388608)}t.writeFloatLE=r.bind(null,n),t.writeFloatBE=r.bind(null,i),t.readFloatLE=e.bind(null,o),t.readFloatBE=e.bind(null,s)}(),"undefined"!=typeof Float64Array?function(){function r(t,r,e){o[0]=t,r[e]=s[0],r[e+1]=s[1],r[e+2]=s[2],r[e+3]=s[3],r[e+4]=s[4],r[e+5]=s[5],r[e+6]=s[6],r[e+7]=s[7]}function e(t,r,e){o[0]=t,r[e]=s[7],r[e+1]=s[6],r[e+2]=s[5],r[e+3]=s[4],r[e+4]=s[3],r[e+5]=s[2],r[e+6]=s[1],r[e+7]=s[0]}function n(t,r){return s[0]=t[r],s[1]=t[r+1],s[2]=t[r+2],s[3]=t[r+3],s[4]=t[r+4],s[5]=t[r+5],s[6]=t[r+6],s[7]=t[r+7],o[0]}function i(t,r){return s[7]=t[r],s[6]=t[r+1],s[5]=t[r+2],s[4]=t[r+3],s[3]=t[r+4],s[2]=t[r+5],s[1]=t[r+6],s[0]=t[r+7],o[0]}var o=new Float64Array([-0]),s=new Uint8Array(o.buffer),u=128===s[7];t.writeDoubleLE=u?r:e,t.writeDoubleBE=u?e:r,t.readDoubleLE=u?n:i,t.readDoubleBE=u?i:n}():function(){function r(t,r,e,n,i,o){var s=n<0?1:0;if(s&&(n=-n),0===n)t(0,i,o+r),t(1/n>0?0:2147483648,i,o+e);else if(isNaN(n))t(0,i,o+r),t(2146959360,i,o+e);else if(n>1.7976931348623157e308)t(0,i,o+r),t((s<<31|2146435072)>>>0,i,o+e);else{var u;if(n<2.2250738585072014e-308)u=n/5e-324,t(u>>>0,i,o+r),t((s<<31|u/4294967296)>>>0,i,o+e);else{var f=Math.floor(Math.log(n)/Math.LN2);1024===f&&(f=1023),u=n*Math.pow(2,-f),t(4503599627370496*u>>>0,i,o+r),t((s<<31|f+1023<<20|1048576*u&1048575)>>>0,i,o+e)}}}function e(t,r,e,n,i){var o=t(n,i+r),s=t(n,i+e),u=2*(s>>31)+1,f=s>>>20&2047,h=4294967296*(1048575&s)+o;return 2047===f?h?NaN:u*(1/0):0===f?5e-324*u*h:u*Math.pow(2,f-1075)*(h+4503599627370496)}t.writeDoubleLE=r.bind(null,n,0,4),t.writeDoubleBE=r.bind(null,i,4,0),t.readDoubleLE=e.bind(null,o,0,4),t.readDoubleBE=e.bind(null,s,4,0)}(),t}function n(t,r,e){r[e]=255&t,r[e+1]=t>>>8&255,r[e+2]=t>>>16&255,r[e+3]=t>>>24}function i(t,r,e){r[e]=t>>>24,r[e+1]=t>>>16&255,r[e+2]=t>>>8&255,r[e+3]=255&t}function o(t,r){return(t[r]|t[r+1]<<8|t[r+2]<<16|t[r+3]<<24)>>>0}function s(t,r){return(t[r]<<24|t[r+1]<<16|t[r+2]<<8|t[r+3])>>>0}r.exports=e(e)},{}],5:[function(t,r,e){function n(t){try{var r=eval("quire".replace(/^/,"re"))(t);if(r&&(r.length||Object.keys(r).length))return r}catch(t){}return null}r.exports=n},{}],6:[function(t,r){function e(t,r,e){var n=e||8192,i=n>>>1,o=null,s=n;return function(e){if(e<1||e>i)return t(e);s+e>n&&(o=t(n),s=0);var u=r.call(o,s,s+=e);return 7&s&&(s=1+(7|s)),u}}r.exports=e},{}],7:[function(t,r,e){var n=e;n.length=function(t){for(var r=0,e=0,n=0;n<t.length;++n)e=t.charCodeAt(n),e<128?r+=1:e<2048?r+=2:55296==(64512&e)&&56320==(64512&t.charCodeAt(n+1))?(++n,r+=4):r+=3;return r},n.read=function(t,r,e){if(e-r<1)return"";for(var n,i=null,o=[],s=0;r<e;)n=t[r++],n<128?o[s++]=n:n>191&&n<224?o[s++]=(31&n)<<6|63&t[r++]:n>239&&n<365?(n=((7&n)<<18|(63&t[r++])<<12|(63&t[r++])<<6|63&t[r++])-65536,o[s++]=55296+(n>>10),o[s++]=56320+(1023&n)):o[s++]=(15&n)<<12|(63&t[r++])<<6|63&t[r++],s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},n.write=function(t,r,e){for(var n,i,o=e,s=0;s<t.length;++s)n=t.charCodeAt(s),n<128?r[e++]=n:n<2048?(r[e++]=n>>6|192,r[e++]=63&n|128):55296==(64512&n)&&56320==(64512&(i=t.charCodeAt(s+1)))?(n=65536+((1023&n)<<10)+(1023&i),++s,r[e++]=n>>18|240,r[e++]=n>>12&63|128,r[e++]=n>>6&63|128,r[e++]=63&n|128):(r[e++]=n>>12|224,r[e++]=n>>6&63|128,r[e++]=63&n|128);return e-o}},{}],8:[function(t,r,e){function n(){i.Reader.b(i.BufferReader),i.util.b()}var i=e;i.build="minimal",i.Writer=t(16),i.BufferWriter=t(17),i.Reader=t(9),i.BufferReader=t(10),i.util=t(15),i.rpc=t(12),i.roots=t(11),i.configure=n,i.Writer.b(i.BufferWriter),n()},{10:10,11:11,12:12,15:15,16:16,17:17,9:9}],9:[function(t,r){function e(t,r){return RangeError("index out of range: "+t.pos+" + "+(r||1)+" > "+t.len)}function n(t){this.buf=t,this.pos=0,this.len=t.length}function i(){var t=new h(0,0),r=0;if(!(this.len-this.pos>4)){for(;r<3;++r){if(this.pos>=this.len)throw e(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*r)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*r)>>>0,t}for(;r<4;++r)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*r)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(r=0,this.len-this.pos>4){for(;r<5;++r)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*r+3)>>>0,this.buf[this.pos++]<128)return t}else for(;r<5;++r){if(this.pos>=this.len)throw e(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*r+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function o(t,r){return(t[r-4]|t[r-3]<<8|t[r-2]<<16|t[r-1]<<24)>>>0}function s(){if(this.pos+8>this.len)throw e(this,8);return new h(o(this.buf,this.pos+=4),o(this.buf,this.pos+=4))}r.exports=n;var u,f=t(15),h=f.LongBits,a=f.utf8,l="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new n(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new n(t);throw Error("illegal buffer")};n.create=f.Buffer?function(t){return(n.create=function(t){return f.Buffer.isBuffer(t)?new u(t):l(t)})(t)}:l,n.prototype.c=f.Array.prototype.subarray||f.Array.prototype.slice,n.prototype.uint32=function(){var t=4294967295;return function(){if(t=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return t;if((this.pos+=5)>this.len)throw this.pos=this.len,e(this,10);return t}}(),n.prototype.int32=function(){return 0|this.uint32()},n.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},n.prototype.bool=function(){return 0!==this.uint32()},n.prototype.fixed32=function(){if(this.pos+4>this.len)throw e(this,4);return o(this.buf,this.pos+=4)},n.prototype.sfixed32=function(){if(this.pos+4>this.len)throw e(this,4);return 0|o(this.buf,this.pos+=4)},n.prototype.float=function(){if(this.pos+4>this.len)throw e(this,4);var t=f.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},n.prototype.double=function(){if(this.pos+8>this.len)throw e(this,4);var t=f.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},n.prototype.bytes=function(){var t=this.uint32(),r=this.pos,n=this.pos+t;if(n>this.len)throw e(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(r,n):r===n?new this.buf.constructor(0):this.c.call(this.buf,r,n)},n.prototype.string=function(){var t=this.bytes();return a.read(t,0,t.length)},n.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw e(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw e(this)}while(128&this.buf[this.pos++]);return this},n.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;;){if(4==(t=7&this.uint32()))break;this.skipType(t)}break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},n.b=function(t){u=t;var r=f.Long?"toLong":"toNumber";f.merge(n.prototype,{int64:function(){return i.call(this)[r](!1)},uint64:function(){return i.call(this)[r](!0)},sint64:function(){return i.call(this).zzDecode()[r](!1)},fixed64:function(){return s.call(this)[r](!0)},sfixed64:function(){return s.call(this)[r](!1)}})}},{15:15}],10:[function(t,r){function e(t){n.call(this,t)}r.exports=e;var n=t(9);(e.prototype=Object.create(n.prototype)).constructor=e;var i=t(15);i.Buffer&&(e.prototype.c=i.Buffer.prototype.slice),e.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len))}},{15:15,9:9}],11:[function(t,r){r.exports={}},{}],12:[function(t,r,e){e.Service=t(13)},{13:13}],13:[function(t,e){function n(t,r,e){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");i.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=!!r,this.responseDelimited=!!e}e.exports=n;var i=t(15);(n.prototype=Object.create(i.EventEmitter.prototype)).constructor=n,n.prototype.rpcCall=function t(e,n,o,s,u){if(!s)throw TypeError("request must be specified");var f=this;if(!u)return i.asPromise(t,f,e,n,o,s);if(!f.rpcImpl)return setTimeout(function(){u(Error("already ended"))},0),r;try{return f.rpcImpl(e,n[f.requestDelimited?"encodeDelimited":"encode"](s).finish(),function(t,n){if(t)return f.emit("error",t,e),u(t);if(null===n)return f.end(!0),r;if(!(n instanceof o))try{n=o[f.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return f.emit("error",t,e),u(t)}return f.emit("data",n,e),u(null,n)})}catch(t){return f.emit("error",t,e),setTimeout(function(){u(t)},0),r}},n.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},{15:15}],14:[function(t,r){function e(t,r){this.lo=t>>>0,this.hi=r>>>0}r.exports=e;var n=t(15),i=e.zero=new e(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=e.zeroHash="\0\0\0\0\0\0\0\0";e.fromNumber=function(t){if(0===t)return i;var r=t<0;r&&(t=-t);var n=t>>>0,o=(t-n)/4294967296>>>0;return r&&(o=~o>>>0,n=~n>>>0,++n>4294967295&&(n=0,++o>4294967295&&(o=0))),new e(n,o)},e.from=function(t){if("number"==typeof t)return e.fromNumber(t);if(n.isString(t)){if(!n.Long)return e.fromNumber(parseInt(t,10));t=n.Long.fromString(t)}return t.low||t.high?new e(t.low>>>0,t.high>>>0):i},e.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var r=1+~this.lo>>>0,e=~this.hi>>>0;return r||(e=e+1>>>0),-(r+4294967296*e)}return this.lo+4294967296*this.hi},e.prototype.toLong=function(t){return n.Long?new n.Long(0|this.lo,0|this.hi,!!t):{low:0|this.lo,high:0|this.hi,unsigned:!!t}};var s=String.prototype.charCodeAt;e.fromHash=function(t){return t===o?i:new e((s.call(t,0)|s.call(t,1)<<8|s.call(t,2)<<16|s.call(t,3)<<24)>>>0,(s.call(t,4)|s.call(t,5)<<8|s.call(t,6)<<16|s.call(t,7)<<24)>>>0)},e.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},e.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},e.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},e.prototype.length=function(){var t=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,e=this.hi>>>24;return 0===e?0===r?t<16384?t<128?1:2:t<2097152?3:4:r<16384?r<128?5:6:r<2097152?7:8:e<128?9:10}},{15:15}],15:[function(e,n,i){function o(t,e,n){for(var i=Object.keys(e),o=0;o<i.length;++o)t[i[o]]!==r&&n||(t[i[o]]=e[i[o]]);return t}function s(t){function r(t,e){if(!(this instanceof r))return new r(t,e);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,r):Object.defineProperty(this,"stack",{value:Error().stack||""}),e&&o(this,e)}return(r.prototype=Object.create(Error.prototype)).constructor=r,Object.defineProperty(r.prototype,"name",{get:function(){return t}}),r.prototype.toString=function(){return this.name+": "+this.message},r}var u=i;u.asPromise=e(1),u.base64=e(2),u.EventEmitter=e(3),u.float=e(4),u.inquire=e(5),u.utf8=e(7),u.pool=e(6),u.LongBits=e(14),u.emptyArray=Object.freeze?Object.freeze([]):[],u.emptyObject=Object.freeze?Object.freeze({}):{},u.isNode=!!(t.process&&t.process.versions&&t.process.versions.node),u.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},u.isString=function(t){return"string"==typeof t||t instanceof String},u.isObject=function(t){return t&&"object"==typeof t},u.isset=u.isSet=function(t,r){var e=t[r];return!(null==e||!t.hasOwnProperty(r))&&("object"!=typeof e||(Array.isArray(e)?e.length:Object.keys(e).length)>0)},u.Buffer=function(){try{var t=u.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),u.d=null,u.e=null,u.newBuffer=function(t){return"number"==typeof t?u.Buffer?u.e(t):new u.Array(t):u.Buffer?u.d(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},u.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,u.Long=t.dcodeIO&&t.dcodeIO.Long||u.inquire("long"),u.key2Re=/^true|false|0|1$/,u.key32Re=/^-?(?:0|[1-9][0-9]*)$/,u.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,u.longToHash=function(t){return t?u.LongBits.from(t).toHash():u.LongBits.zeroHash},u.longFromHash=function(t,r){var e=u.LongBits.fromHash(t);return u.Long?u.Long.fromBits(e.lo,e.hi,r):e.toNumber(!!r)},u.merge=o,u.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},u.newError=s,u.ProtocolError=s("ProtocolError"),u.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===e[t[n]]&&this[t[n]]!==r&&null!==this[t[n]])return t[n]}},u.oneOfSetter=function(t){return function(r){for(var e=0;e<t.length;++e)t[e]!==r&&delete this[t[e]]}},u.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},u.b=function(){var t=u.Buffer;if(!t)return void(u.d=u.e=null);u.d=t.from!==Uint8Array.from&&t.from||function(r,e){return new t(r,e)},u.e=t.allocUnsafe||function(r){return new t(r)}}},{1:1,14:14,2:2,3:3,4:4,5:5,6:6,7:7}],16:[function(t,e){function n(t,e,n){this.fn=t,this.len=e,this.next=r,this.val=n}function i(){}function o(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function s(){this.len=0,this.head=new n(i,0,0),this.tail=this.head,this.states=null}function u(t,r,e){r[e]=255&t}function f(t,r,e){for(;t>127;)r[e++]=127&t|128,t>>>=7;r[e]=t}function h(t,e){this.len=t,this.next=r,this.val=e}function a(t,r,e){for(;t.hi;)r[e++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;t.lo>127;)r[e++]=127&t.lo|128,t.lo=t.lo>>>7;r[e++]=t.lo}function l(t,r,e){r[e]=255&t,r[e+1]=t>>>8&255,r[e+2]=t>>>16&255,r[e+3]=t>>>24}e.exports=s;var c,p=t(15),y=p.LongBits,d=p.base64,b=p.utf8;s.create=p.Buffer?function(){return(s.create=function(){return new c})()}:function(){return new s},s.alloc=function(t){return new p.Array(t)},p.Array!==Array&&(s.alloc=p.pool(s.alloc,p.Array.prototype.subarray)),s.prototype.f=function(t,r,e){return this.tail=this.tail.next=new n(t,r,e),this.len+=r,this},h.prototype=Object.create(n.prototype),h.prototype.fn=f,s.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new h((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},s.prototype.int32=function(t){return t<0?this.f(a,10,y.fromNumber(t)):this.uint32(t)},s.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},s.prototype.uint64=function(t){var r=y.from(t);return this.f(a,r.length(),r)},s.prototype.int64=s.prototype.uint64,s.prototype.sint64=function(t){var r=y.from(t).zzEncode();return this.f(a,r.length(),r)},s.prototype.bool=function(t){return this.f(u,1,t?1:0)},s.prototype.fixed32=function(t){return this.f(l,4,t>>>0)},s.prototype.sfixed32=s.prototype.fixed32,s.prototype.fixed64=function(t){var r=y.from(t);return this.f(l,4,r.lo).f(l,4,r.hi)},s.prototype.sfixed64=s.prototype.fixed64,s.prototype.float=function(t){return this.f(p.float.writeFloatLE,4,t)},s.prototype.double=function(t){return this.f(p.float.writeDoubleLE,8,t)};var g=p.Array.prototype.set?function(t,r,e){r.set(t,e)}:function(t,r,e){for(var n=0;n<t.length;++n)r[e+n]=t[n]};s.prototype.bytes=function(t){var r=t.length>>>0;if(!r)return this.f(u,1,0);if(p.isString(t)){var e=s.alloc(r=d.length(t));d.decode(t,e,0),t=e}return this.uint32(r).f(g,r,t)},s.prototype.string=function(t){var r=b.length(t);return r?this.uint32(r).f(b.write,r,t):this.f(u,1,0)},s.prototype.fork=function(){return this.states=new o(this),this.head=this.tail=new n(i,0,0),this.len=0,this},s.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new n(i,0,0),this.len=0),this},s.prototype.ldelim=function(){var t=this.head,r=this.tail,e=this.len;return this.reset().uint32(e),e&&(this.tail.next=t.next,this.tail=r,this.len+=e),this},s.prototype.finish=function(){for(var t=this.head.next,r=this.constructor.alloc(this.len),e=0;t;)t.fn(t.val,r,e),e+=t.len,t=t.next;return r},s.b=function(t){c=t}},{15:15}],17:[function(t,r){function e(){i.call(this)}function n(t,r,e){t.length<40?o.utf8.write(t,r,e):r.utf8Write(t,e)}r.exports=e;var i=t(16);(e.prototype=Object.create(i.prototype)).constructor=e;var o=t(15),s=o.Buffer;e.alloc=function(t){return(e.alloc=o.e)(t)};var u=s&&s.prototype instanceof Uint8Array&&"set"===s.prototype.set.name?function(t,r,e){r.set(t,e)}:function(t,r,e){if(t.copy)t.copy(r,e,0,t.length);else for(var n=0;n<t.length;)r[e++]=t[n++]};e.prototype.bytes=function(t){o.isString(t)&&(t=o.d(t,"base64"));var r=t.length>>>0;return this.uint32(r),r&&this.f(u,r,t),this},e.prototype.string=function(t){var r=s.byteLength(t);return this.uint32(r),r&&this.f(n,r,t),this}},{15:15,16:16}]},{},[8])}("object"==typeof window&&window||"object"==typeof self&&self||this);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:53:"/bitrix/js/pull/protobuf/model.min.js?156759068313978";s:6:"source";s:33:"/bitrix/js/pull/protobuf/model.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
(function(e){"use strict";var n=e.Reader,t=e.Writer,r=e.util;var s=e.roots["push-server"]||(e.roots["push-server"]={});s.RequestBatch=function(){function e(e){this.requests=[];if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.requests=r.emptyArray;e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.requests!=null&&n.requests.length)for(var i=0;i<n.requests.length;++i)s.Request.encode(n.requests[i],r.uint32(10).fork()).ldelim();return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.RequestBatch;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:if(!(o.requests&&o.requests.length))o.requests=[];o.requests.push(s.Request.decode(t,t.uint32()));break;default:t.skipType(a&7);break}}return o};return e}();s.Request=function(){function e(e){if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.incomingMessages=null;e.prototype.channelStats=null;e.prototype.serverStats=null;var i;Object.defineProperty(e.prototype,"command",{get:r.oneOfGetter(i=["incomingMessages","channelStats","serverStats"]),set:r.oneOfSetter(i)});e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.incomingMessages!=null&&n.hasOwnProperty("incomingMessages"))s.IncomingMessagesRequest.encode(n.incomingMessages,r.uint32(10).fork()).ldelim();if(n.channelStats!=null&&n.hasOwnProperty("channelStats"))s.ChannelStatsRequest.encode(n.channelStats,r.uint32(18).fork()).ldelim();if(n.serverStats!=null&&n.hasOwnProperty("serverStats"))s.ServerStatsRequest.encode(n.serverStats,r.uint32(26).fork()).ldelim();return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.Request;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:o.incomingMessages=s.IncomingMessagesRequest.decode(t,t.uint32());break;case 2:o.channelStats=s.ChannelStatsRequest.decode(t,t.uint32());break;case 3:o.serverStats=s.ServerStatsRequest.decode(t,t.uint32());break;default:t.skipType(a&7);break}}return o};return e}();s.IncomingMessagesRequest=function(){function e(e){this.messages=[];if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.messages=r.emptyArray;e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.messages!=null&&n.messages.length)for(var i=0;i<n.messages.length;++i)s.IncomingMessage.encode(n.messages[i],r.uint32(10).fork()).ldelim();return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.IncomingMessagesRequest;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:if(!(o.messages&&o.messages.length))o.messages=[];o.messages.push(s.IncomingMessage.decode(t,t.uint32()));break;default:t.skipType(a&7);break}}return o};return e}();s.IncomingMessage=function(){function e(e){this.receivers=[];if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.receivers=r.emptyArray;e.prototype.sender=null;e.prototype.body="";e.prototype.expiry=0;e.prototype.type="";e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.receivers!=null&&n.receivers.length)for(var i=0;i<n.receivers.length;++i)s.Receiver.encode(n.receivers[i],r.uint32(10).fork()).ldelim();if(n.sender!=null&&n.hasOwnProperty("sender"))s.Sender.encode(n.sender,r.uint32(18).fork()).ldelim();if(n.body!=null&&n.hasOwnProperty("body"))r.uint32(26).string(n.body);if(n.expiry!=null&&n.hasOwnProperty("expiry"))r.uint32(32).uint32(n.expiry);if(n.type!=null&&n.hasOwnProperty("type"))r.uint32(42).string(n.type);return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.IncomingMessage;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:if(!(o.receivers&&o.receivers.length))o.receivers=[];o.receivers.push(s.Receiver.decode(t,t.uint32()));break;case 2:o.sender=s.Sender.decode(t,t.uint32());break;case 3:o.body=t.string();break;case 4:o.expiry=t.uint32();break;case 5:o.type=t.string();break;default:t.skipType(a&7);break}}return o};return e}();s.ChannelStatsRequest=function(){function e(e){this.channels=[];if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.channels=r.emptyArray;e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.channels!=null&&n.channels.length)for(var i=0;i<n.channels.length;++i)s.ChannelId.encode(n.channels[i],r.uint32(10).fork()).ldelim();return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.ChannelStatsRequest;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:if(!(o.channels&&o.channels.length))o.channels=[];o.channels.push(s.ChannelId.decode(t,t.uint32()));break;default:t.skipType(a&7);break}}return o};return e}();s.ChannelId=function(){function e(e){if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.id=r.newBuffer([]);e.prototype.isPrivate=false;e.prototype.signature=r.newBuffer([]);e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.id!=null&&n.hasOwnProperty("id"))r.uint32(10).bytes(n.id);if(n.isPrivate!=null&&n.hasOwnProperty("isPrivate"))r.uint32(16).bool(n.isPrivate);if(n.signature!=null&&n.hasOwnProperty("signature"))r.uint32(26).bytes(n.signature);return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.ChannelId;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:o.id=t.bytes();break;case 2:o.isPrivate=t.bool();break;case 3:o.signature=t.bytes();break;default:t.skipType(a&7);break}}return o};return e}();s.ServerStatsRequest=function(){function e(e){if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.ServerStatsRequest;while(t.pos<i){var a=t.uint32();switch(a>>>3){default:t.skipType(a&7);break}}return o};return e}();s.Sender=function(){function e(e){if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.type=0;e.prototype.id=r.newBuffer([]);e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.type!=null&&n.hasOwnProperty("type"))r.uint32(8).int32(n.type);if(n.id!=null&&n.hasOwnProperty("id"))r.uint32(18).bytes(n.id);return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.Sender;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:o.type=t.int32();break;case 2:o.id=t.bytes();break;default:t.skipType(a&7);break}}return o};return e}();s.SenderType=function(){var e={},n=Object.create(e);n[e[0]="UNKNOWN"]=0;n[e[1]="CLIENT"]=1;n[e[2]="BACKEND"]=2;return n}();s.Receiver=function(){function e(e){if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.id=r.newBuffer([]);e.prototype.isPrivate=false;e.prototype.signature=r.newBuffer([]);e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.id!=null&&n.hasOwnProperty("id"))r.uint32(10).bytes(n.id);if(n.isPrivate!=null&&n.hasOwnProperty("isPrivate"))r.uint32(16).bool(n.isPrivate);if(n.signature!=null&&n.hasOwnProperty("signature"))r.uint32(26).bytes(n.signature);return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.Receiver;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:o.id=t.bytes();break;case 2:o.isPrivate=t.bool();break;case 3:o.signature=t.bytes();break;default:t.skipType(a&7);break}}return o};return e}();s.ResponseBatch=function(){function e(e){this.responses=[];if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.responses=r.emptyArray;e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.responses!=null&&n.responses.length)for(var i=0;i<n.responses.length;++i)s.Response.encode(n.responses[i],r.uint32(10).fork()).ldelim();return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.ResponseBatch;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:if(!(o.responses&&o.responses.length))o.responses=[];o.responses.push(s.Response.decode(t,t.uint32()));break;default:t.skipType(a&7);break}}return o};return e}();s.Response=function(){function e(e){if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.outgoingMessages=null;e.prototype.channelStats=null;e.prototype.serverStats=null;var i;Object.defineProperty(e.prototype,"command",{get:r.oneOfGetter(i=["outgoingMessages","channelStats","serverStats"]),set:r.oneOfSetter(i)});e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.outgoingMessages!=null&&n.hasOwnProperty("outgoingMessages"))s.OutgoingMessagesResponse.encode(n.outgoingMessages,r.uint32(10).fork()).ldelim();if(n.channelStats!=null&&n.hasOwnProperty("channelStats"))s.ChannelStatsResponse.encode(n.channelStats,r.uint32(18).fork()).ldelim();if(n.serverStats!=null&&n.hasOwnProperty("serverStats"))s.JsonResponse.encode(n.serverStats,r.uint32(26).fork()).ldelim();return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.Response;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:o.outgoingMessages=s.OutgoingMessagesResponse.decode(t,t.uint32());break;case 2:o.channelStats=s.ChannelStatsResponse.decode(t,t.uint32());break;case 3:o.serverStats=s.JsonResponse.decode(t,t.uint32());break;default:t.skipType(a&7);break}}return o};return e}();s.OutgoingMessagesResponse=function(){function e(e){this.messages=[];if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.messages=r.emptyArray;e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.messages!=null&&n.messages.length)for(var i=0;i<n.messages.length;++i)s.OutgoingMessage.encode(n.messages[i],r.uint32(10).fork()).ldelim();return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.OutgoingMessagesResponse;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:if(!(o.messages&&o.messages.length))o.messages=[];o.messages.push(s.OutgoingMessage.decode(t,t.uint32()));break;default:t.skipType(a&7);break}}return o};return e}();s.OutgoingMessage=function(){function e(e){if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.id=r.newBuffer([]);e.prototype.body="";e.prototype.expiry=0;e.prototype.created=0;e.prototype.sender=null;e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.id!=null&&n.hasOwnProperty("id"))r.uint32(10).bytes(n.id);if(n.body!=null&&n.hasOwnProperty("body"))r.uint32(18).string(n.body);if(n.expiry!=null&&n.hasOwnProperty("expiry"))r.uint32(24).uint32(n.expiry);if(n.created!=null&&n.hasOwnProperty("created"))r.uint32(37).fixed32(n.created);if(n.sender!=null&&n.hasOwnProperty("sender"))s.Sender.encode(n.sender,r.uint32(42).fork()).ldelim();return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.OutgoingMessage;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:o.id=t.bytes();break;case 2:o.body=t.string();break;case 3:o.expiry=t.uint32();break;case 4:o.created=t.fixed32();break;case 5:o.sender=s.Sender.decode(t,t.uint32());break;default:t.skipType(a&7);break}}return o};return e}();s.ChannelStatsResponse=function(){function e(e){this.channels=[];if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.channels=r.emptyArray;e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.channels!=null&&n.channels.length)for(var i=0;i<n.channels.length;++i)s.ChannelStats.encode(n.channels[i],r.uint32(10).fork()).ldelim();return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.ChannelStatsResponse;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:if(!(o.channels&&o.channels.length))o.channels=[];o.channels.push(s.ChannelStats.decode(t,t.uint32()));break;default:t.skipType(a&7);break}}return o};return e}();s.ChannelStats=function(){function e(e){if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.id=r.newBuffer([]);e.prototype.isPrivate=false;e.prototype.isOnline=false;e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.id!=null&&n.hasOwnProperty("id"))r.uint32(10).bytes(n.id);if(n.isPrivate!=null&&n.hasOwnProperty("isPrivate"))r.uint32(16).bool(n.isPrivate);if(n.isOnline!=null&&n.hasOwnProperty("isOnline"))r.uint32(24).bool(n.isOnline);return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.ChannelStats;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:o.id=t.bytes();break;case 2:o.isPrivate=t.bool();break;case 3:o.isOnline=t.bool();break;default:t.skipType(a&7);break}}return o};return e}();s.JsonResponse=function(){function e(e){if(e)for(var n=Object.keys(e),t=0;t<n.length;++t)if(e[n[t]]!=null)this[n[t]]=e[n[t]]}e.prototype.json="";e.create=function n(t){return new e(t)};e.encode=function e(n,r){if(!r)r=t.create();if(n.json!=null&&n.hasOwnProperty("json"))r.uint32(10).string(n.json);return r};e.decode=function e(t,r){if(!(t instanceof n))t=n.create(t);var i=r===undefined?t.len:t.pos+r,o=new s.JsonResponse;while(t.pos<i){var a=t.uint32();switch(a>>>3){case 1:o.json=t.string();break;default:t.skipType(a&7);break}}return o};return e}();return s})(protobuf);
/* End */
;
; /* Start:"a:4:{s:4:"full";s:57:"/bitrix/js/pull/client/pull.client.min.js?156759068339145";s:6:"source";s:37:"/bitrix/js/pull/client/pull.client.js";s:3:"min";s:41:"/bitrix/js/pull/client/pull.client.min.js";s:3:"map";s:41:"/bitrix/js/pull/client/pull.client.map.js";}"*/
(function(){if(!window.BX){window.BX={}}else if(window.BX.PullClient){return}var e=window.BX;var t=window.protobuf;var n=19;var o=60;var i=30*60;var s=24*60*60;var r=6e4;var c="bx-pull-session";var a=20;var u={WebSocket:"webSocket",LongPolling:"longPolling"};var l={Online:"online",Offline:"offline",Connecting:"connect"};var h={Unknown:0,Client:1,Backend:2};var f={Server:"server",Client:"client",Online:"online",Status:"status",Revision:"revision"};var d={NORMAL_CLOSURE:1e3,SERVER_DIE:1001,CONFIG_REPLACED:3e3,CHANNEL_EXPIRED:3001,SERVER_RESTARTED:3002,CONFIG_EXPIRED:3003,MANUAL:3004};var p={CHANNEL_EXPIRE:"CHANNEL_EXPIRE",CONFIG_EXPIRE:"CONFIG_EXPIRE",SERVER_RESTART:"SERVER_RESTART"};var g=t.roots["push-server"]["Response"];var m=t.roots["push-server"]["ResponseBatch"];var y=t.roots["push-server"]["Request"];var b=t.roots["push-server"]["RequestBatch"];var v=t.roots["push-server"]["IncomingMessagesRequest"];var k=t.roots["push-server"]["IncomingMessage"];var S=t.roots["push-server"]["Receiver"];var E=function(t){t=t||{};var n=this;this.context="master";this.userId=t.userId?t.userId:typeof e.message!=="undefined"&&e.message.USER_ID?e.message.USER_ID:0;this.siteId=t.siteId?t.siteId:typeof e.message!=="undefined"&&e.message.SITE_ID?e.message.SITE_ID:"none";this.restClient=typeof t.restClient!=="undefined"?t.restClient:e.rest;this.enabled=typeof t.serverEnabled!=="undefined"?t.serverEnabled==="Y"||t.serverEnabled===true:typeof e.message!=="undefined"&&e.message.pull_server_enabled==="Y";this.unloading=false;this.starting=false;this.debug=false;this.connectionAttempt=0;this.connectionType="";this.reconnectTimeout=null;this.restoreWebSocketTimeout=null;this.skipCheckRevision=t.skipCheckRevision===true;this._subscribers={};this.watchTagsQueue={};this.watchUpdateInterval=174e4;this.watchForceUpdateInterval=5e3;if(typeof t.configTimestamp!=="undefined"){this.configTimestamp=t.configTimestamp}else if(typeof e.message!=="undefined"&&e.message.pull_config_timestamp){this.configTimestamp=e.message.pull_config_timestamp}else{this.configTimestamp=0}this.session={mid:null,tag:null,time:null,history:{},messageCount:0};this._connectors={webSocket:null,longPolling:null};Object.defineProperty(this,"connector",{get:function(){return n._connectors[n.connectionType]}});this.isSecure=document.location.href.indexOf("https")===0;this.config=null;this.storage=new R({userId:this.userId,siteId:this.siteId});this.sharedConfig=new C({onWebSocketBlockChanged:this.onWebSocketBlockChanged.bind(this),storage:this.storage});this.channelManager=new _({restClient:this.restClient});this.notificationPopup=null;this.checkInterval=null;this.offlineTimeout=null;this.isManualDisconnect=false};E.prototype.subscribe=function(e){if(!e){console.error(L.getDateForLog()+": Pull.subscribe: params for subscribe function is invalid. ");return function(){}}if(!L.isPlainObject(e)){return this.attachCommandHandler(e)}e=e||{};e.type=e.type||f.Server;e.command=e.command||null;if(e.type==f.Server||e.type==f.Client){if(typeof this._subscribers[e.type]==="undefined"){this._subscribers[e.type]={}}if(typeof this._subscribers[e.type][e.moduleId]==="undefined"){this._subscribers[e.type][e.moduleId]={callbacks:[],commands:{}}}if(e.command){if(typeof this._subscribers[e.type][e.moduleId]["commands"][e.command]==="undefined"){this._subscribers[e.type][e.moduleId]["commands"][e.command]=[]}this._subscribers[e.type][e.moduleId]["commands"][e.command].push(e.callback);return function(){this._subscribers[e.type][e.moduleId]["commands"][e.command]=this._subscribers[e.type][e.moduleId]["commands"][e.command].filter(function(t){return t!==e.callback})}.bind(this)}else{this._subscribers[e.type][e.moduleId]["callbacks"].push(e.callback);return function(){this._subscribers[e.type][e.moduleId]["callbacks"]=this._subscribers[e.type][e.moduleId]["callbacks"].filter(function(t){return t!==e.callback})}.bind(this)}}else{if(typeof this._subscribers[e.type]==="undefined"){this._subscribers[e.type]=[]}this._subscribers[e.type].push(e.callback);return function(){this._subscribers[e.type]=this._subscribers[e.type].filter(function(t){return t!==e.callback})}.bind(this)}};E.prototype.attachCommandHandler=function(e){if(typeof e.getModuleId!=="function"||typeof e.getModuleId()!=="string"){console.error(L.getDateForLog()+": Pull.attachCommandHandler: result of handler.getModuleId() is not a string.");return function(){}}var t=f.Server;if(typeof e.getSubscriptionType==="function"){t=e.getSubscriptionType()}this.subscribe({type:t,moduleId:e.getModuleId(),callback:function(t){var n=null;if(typeof e.getMap==="function"){var o=e.getMap();if(o&&typeof o==="object"){if(typeof o[t.command]==="function"){n=o[t.command].bind(e)}else if(typeof o[t.command]==="string"&&typeof e[o[t.command]]==="function"){n=e[o[t.command]].bind(e)}}}if(!n){var i="handle"+t.command.charAt(0).toUpperCase()+t.command.slice(1);if(typeof e[i]==="function"){n=e[i].bind(e)}}if(n){if(this.debug&&this.context!=="master"){console.warn(L.getDateForLog()+": Pull.attachCommandHandler: receive command",t)}n(t.params,t.extra,t.command)}}.bind(this)})};E.prototype.emit=function(e){e=e||{};if(e.type==f.Server||e.type==f.Client){if(typeof this._subscribers[e.type]==="undefined"){this._subscribers[e.type]={}}if(typeof this._subscribers[e.type][e.moduleId]==="undefined"){this._subscribers[e.type][e.moduleId]={callbacks:[],commands:{}}}if(this._subscribers[e.type][e.moduleId]["callbacks"].length>0){this._subscribers[e.type][e.moduleId]["callbacks"].forEach(function(t){t(e.data,{type:e.type,moduleId:e.moduleId})})}if(this._subscribers[e.type][e.moduleId]["commands"][e.data.command]&&this._subscribers[e.type][e.moduleId]["commands"][e.data.command].length>0){this._subscribers[e.type][e.moduleId]["commands"][e.data.command].forEach(function(t){t(e.data.params,e.data.extra,e.data.command,{type:e.type,moduleId:e.moduleId})})}return true}else{if(typeof this._subscribers[e.type]==="undefined"){this._subscribers[e.type]=[]}if(this._subscribers[e.type].length<=0){return true}this._subscribers[e.type].forEach(function(t){t(e.data,{type:e.type})});return true}};E.prototype.init=function(){this._connectors.webSocket=new P({parent:this,onOpen:this.onWebSocketOpen.bind(this),onMessage:this.parseResponse.bind(this),onDisconnect:this.onWebSocketDisconnect.bind(this),onError:this.onWebSocketError.bind(this)});this._connectors.longPolling=new T({parent:this,onOpen:this.onLongPollingOpen.bind(this),onMessage:this.parseResponse.bind(this),onDisconnect:this.onLongPollingDisconnect.bind(this),onError:this.onLongPollingError.bind(this)});this.connectionType=this.isWebSocketAllowed()?u.WebSocket:u.LongPolling;window.addEventListener("beforeunload",this.onBeforeUnload.bind(this));window.addEventListener("offline",this.onOffline.bind(this));window.addEventListener("online",this.onOnline.bind(this));if(e&&e.addCustomEvent){e.addCustomEvent("BXLinkOpened",this.connect.bind(this))}if(e&&e.desktop){e.desktop.addCustomEvent("BXLoginSuccess",function(){this.restart(1e3,"Desktop login")}.bind(this))}};E.prototype.start=function(t){if(this.starting||this.isConnected()){return}if(!this.userId&&typeof e.message!=="undefined"&&e.message.USER_ID){this.userId=e.message.USER_ID}if(this.siteId==="none"&&typeof e.message!=="undefined"&&e.message.SITE_ID){this.siteId=e.message.SITE_ID}var n=new e.Promise;if(L.isPlainObject(t)){this.config=t}if(!this.enabled){n.reject({ex:{error:"PULL_DISABLED",error_description:"Push & Pull server is disabled"}});return n}var o=this;var i=(new Date).getTime();var s=this.storage.get(c);if(L.isPlainObject(s)&&s.hasOwnProperty("ttl")&&s.ttl>=i){this.session.mid=s.mid}this.starting=true;this.loadConfig().catch(function(e){o.starting=false;o.sendPullStatus(l.Offline);o.stopCheckConfig();console.error(L.getDateForLog()+": Pull: could not read push-server config. ",e);n.reject(e)}).then(function(e){o.setConfig(e);o.init();o.connect();o.updateWatch();o.startCheckConfig();n.resolve(true)});return n};E.prototype.setLastMessageId=function(e){this.session.mid=e};E.prototype.setPublicIds=function(e){return this.channelManager.setPublicIds(e)};E.prototype.sendMessage=function(e,t,n,o,i){return this.sendMessageBatch([{users:e,moduleId:t,command:n,params:o,expiry:i}])};E.prototype.sendMessageBatch=function(e){if(!this.isPublishingEnabled()){console.error("Client publishing is not supported or is disabled");return false}var t=[];var n={};for(var o=0;o<e.length;o++){for(var i=0;i<e[o].users.length;i++){n[e[o].users[i]]=true}}this.channelManager.getPublicIds(Object.keys(n)).then(function(n){e.forEach(function(e){var o={module_id:e.moduleId,command:e.command,params:e.params};var i=k.create({receivers:this.createMessageReceivers(e.users,n),body:JSON.stringify(o),expiry:e.expiry||0});t.push(i)},this);var o=b.create({requests:[{incomingMessages:{messages:t}}]});var i=b.encode(o).finish();return this.connector.send(i)}.bind(this))};E.prototype.createMessageReceivers=function(e,t){var n=[];for(var o=0;o<e.length;o++){var i=e[o];if(!t[i]||!t[i].publicId){throw new Error("Could not determine public id for user "+i)}n.push(S.create({id:this.encodeId(t[i].publicId),signature:this.encodeId(t[i].signature)}))}return n};E.prototype.restart=function(t,n){var o=this;this.disconnect(t,n);this.storage.remove("bx-pull-config");this.config=null;this.loadConfig().catch(function(t){console.error(L.getDateForLog()+": Pull: could not read push-server config",t);o.sendPullStatus(l.Offline);clearTimeout(o.reconnectTimeout);if(t.status==401||t.status==403){o.stopCheckConfig();if(e&&e.onCustomEvent){e.onCustomEvent(window,"onPullError",["AUTHORIZE_ERROR"])}}}).then(function(e){o.setConfig(e);o.connect();o.updateWatch();o.startCheckConfig()})};E.prototype.loadConfig=function(){var t=new e.Promise;if(!this.config){this.config={api:{},channels:{},server:{timeShift:0}};var n=this.storage.get("bx-pull-config");if(this.isConfigActual(n)&&this.checkRevision(n.api.revision_web)){t.resolve(n);return t}else{this.storage.remove("bx-pull-config")}}else if(this.isConfigActual(this.config)&&this.checkRevision(this.config.api.revision_web)){t.resolve(this.config);return t}else{this.config={api:{},channels:{},server:{timeShift:0}}}this.restClient.callBatch({serverTime:["server.time"],configGet:["pull.config.get",{CACHE:"N"}]},function(e){if(!e){t.reject(new Error("Network error while getting new config"));return false}var n=0;if(e.serverTime&&!e.serverTime.error()){n=Math.floor((L.getTimestamp()-new Date(e.serverTime.data()).getTime())/1e3)}if(e.configGet.error()){var o=e.configGet.error();if(o.getError().error=="AUTHORIZE_ERROR"||o.getError().error=="WRONG_AUTH_TYPE"){o.status=403}t.reject(o)}else if(e.configGet){var i=e.configGet.data();i.server.timeShift=n;t.resolve(i)}},false,false,"pull.config");return t};E.prototype.isConfigActual=function(e){if(!L.isPlainObject(e)){return false}if(e.server.config_timestamp<this.configTimestamp){return false}var t=new Date;var n=Object.keys(e.channels).length;if(n===0){return false}for(var o in e.channels){if(!e.channels.hasOwnProperty(o)){continue}var i=e.channels[o];var s=new Date(i.end);if(s<t){return false}}return true};E.prototype.startCheckConfig=function(){if(this.checkInterval){clearInterval(this.checkInterval)}this.checkInterval=setInterval(this.checkConfig.bind(this),r)};E.prototype.stopCheckConfig=function(){if(this.checkInterval){clearInterval(this.checkInterval)}this.checkInterval=null};E.prototype.checkConfig=function(){if(this.isConfigActual(this.config)){if(!this.checkRevision(this.config.api.revision_web)){return false}}else{console.log(L.getDateForLog()+": Stale config detected. Restarting");this.restart(d.CONFIG_EXPIRED,"Config update required")}};E.prototype.setConfig=function(e){for(var t in e){if(e.hasOwnProperty(t)&&this.config.hasOwnProperty(t)){this.config[t]=e[t]}}this.storage.set("bx-pull-config",e)};E.prototype.isWebSocketSupported=function(){return typeof window.WebSocket!=="undefined"};E.prototype.isWebSocketAllowed=function(){if(this.sharedConfig.isWebSocketBlocked()){return false}return this.isWebSocketEnabled()};E.prototype.isWebSocketEnabled=function(){if(!this.isWebSocketSupported()){return false}return this.config.server.websocket_enabled===true};E.prototype.isPublishingSupported=function(){return this.getServerVersion()>3};E.prototype.isPublishingEnabled=function(){if(!this.isPublishingSupported()){return false}return this.config.server.publish_enabled===true};E.prototype.isProtobufSupported=function(){return this.getServerVersion()>3&&!L.browser.IsIe()};E.prototype.disconnect=function(e,t){if(this.connector){this.isManualDisconnect=true;this.connector.disconnect(e,t)}};E.prototype.stop=function(e,t){this.disconnect(e,t);this.stopCheckConfig()};E.prototype.reconnect=function(e,t,n){this.disconnect(e,t);n=n||1;this.scheduleReconnect(n)};E.prototype.restoreWebSocketConnection=function(){if(this.connectionType==u.WebSocket){return true}this._connectors.webSocket.connect()};E.prototype.scheduleReconnect=function(e){if(!this.enabled)return false;if(!e){if(this.connectionAttempt>3&&this.connectionType===u.WebSocket){this.sharedConfig.setWebSocketBlocked(true);this.connectionType=u.LongPolling;this.connectionAttempt=1;e=1}else{e=this.getConnectionAttemptDelay(this.connectionAttempt)}}if(this.reconnectTimeout){clearTimeout(this.reconnectTimeout)}console.log(L.getDateForLog()+": Pull: scheduling reconnection in "+e+" seconds; attempt # "+this.connectionAttempt);this.reconnectTimeout=setTimeout(this.connect.bind(this),e*1e3)};E.prototype.scheduleRestoreWebSocketConnection=function(){console.log(L.getDateForLog()+": Pull: scheduling restoration of websocket connection in "+i+" seconds");var e=this;if(this.restoreWebSocketTimeout){return}this.restoreWebSocketTimeout=setTimeout(function(){e.restoreWebSocketTimeout=0;e.restoreWebSocketConnection()},i*1e3)};E.prototype.connect=function(){if(!this.enabled||this.connector.connected){return false}if(this.reconnectTimeout){clearTimeout(this.reconnectTimeout)}this.sendPullStatus(l.Connecting);this.connectionAttempt++;this.connector.connect()};E.prototype.parseResponse=function(e){var t;var n=this.extractMessages(e);var o=[];if(n.length===0){this.session.mid=null;return}for(var i=0;i<n.length;i++){var s=n[i];this.session.mid=s.mid||null;this.session.tag=s.tag||null;this.session.time=s.time||null;o.push(s.text);if(!this.session.history[s.text.module_id]){this.session.history[s.text.module_id]={}}if(!this.session.history[s.text.module_id][s.text.command]){this.session.history[s.text.module_id][s.text.command]=0}this.session.history[s.text.module_id][s.text.command]++;this.session.messageCount++}this.broadcastMessages(o)};E.prototype.extractMessages=function(e){if(e instanceof ArrayBuffer){return this.extractProtobufMessages(e)}else if(L.isNotEmptyString(e)){return this.extractPlainTextMessages(e)}};E.prototype.extractProtobufMessages=function(e){var t=[];try{var n=m.decode(new Uint8Array(e));for(var o=0;o<n.responses.length;o++){var i=n.responses[o];if(i.command!="outgoingMessages"){continue}var s=n.responses[o].outgoingMessages.messages;for(var r=0;r<s.length;r++){var c=s[r];var a;try{a=JSON.parse(c.body)}catch(e){console.error(L.getDateForLog()+": Pull: Could not parse message body",e);continue}if(!a.extra){a.extra={}}a.extra.sender={type:c.sender.type};if(c.sender.id instanceof Uint8Array){a.extra.sender.id=this.decodeId(c.sender.id)}var u={mid:this.decodeId(c.id),text:a};t.push(u)}}}catch(e){console.error(L.getDateForLog()+": Pull: Could not parse message",e)}return t};E.prototype.extractPlainTextMessages=function(e){var t=[];var n=e.match(/#!NGINXNMS!#(.*?)#!NGINXNME!#/gm);if(n===null){text="\n========= PULL ERROR ===========\n"+"Error type: parseResponse error parsing message\n"+"\n"+"Data string: "+e+"\n"+"================================\n\n";console.warn(text);return t}for(var o=0;o<n.length;o++){n[o]=n[o].substring(12,n[o].length-12);if(n[o].length<=0){continue}try{var i=JSON.parse(n[o])}catch(e){continue}t.push(i)}return t};E.prototype.decodeId=function(e){if(!(e instanceof Uint8Array)){throw new Error("encodedId should be an instance of Uint8Array")}var t="";for(var n=0;n<e.length;n++){var o=e[n].toString(16);if(o.length===1){t+="0"}t+=o}return t};E.prototype.encodeId=function(e){if(!e){return new Uint8Array}var t=[];for(var n=0;n<e.length;n+=2){t.push(parseInt(e.substr(n,2),16))}return new Uint8Array(t)};E.prototype.broadcastMessages=function(t){t.forEach(function(t){var n=t.module_id=t.module_id.toLowerCase();var o=t.command;if(!t.extra){t.extra={}}if(t.extra.server_time_unix){t.extra.server_time_ago=(L.getTimestamp()-t.extra.server_time_unix*1e3)/1e3-(this.config.server.timeShift?this.config.server.timeShift:0);t.extra.server_time_ago=t.extra.server_time_ago>0?t.extra.server_time_ago:0}this.logMessage(t);try{if(t.extra.sender&&t.extra.sender.type===h.Client){if(typeof e.onCustomEvent!=="undefined"){e.onCustomEvent(window,"onPullClientEvent-"+n,[o,t.params,t.extra],true);e.onCustomEvent(window,"onPullClientEvent",[n,o,t.params,t.extra],true)}this.emit({type:f.Client,moduleId:n,data:{command:o,params:L.clone(t.params),extra:L.clone(t.extra)}})}else if(n==="pull"){this.handleInternalPullEvent(o,t)}else if(n=="online"){if(t.extra.server_time_ago<240){if(typeof e.onCustomEvent!=="undefined"){e.onCustomEvent(window,"onPullOnlineEvent",[o,t.params,t.extra],true)}this.emit({type:f.Online,data:{command:o,params:L.clone(t.params),extra:L.clone(t.extra)}})}}else{if(typeof e.onCustomEvent!=="undefined"){e.onCustomEvent(window,"onPullEvent-"+n,[o,t.params,t.extra],true);e.onCustomEvent(window,"onPullEvent",[n,o,t.params,t.extra],true)}this.emit({type:f.Server,moduleId:n,data:{command:o,params:L.clone(t.params),extra:L.clone(t.extra)}})}}catch(n){if(typeof console=="object"){console.warn("\n========= PULL ERROR ===========\n"+"Error type: broadcastMessages execute error\n"+"Error event: ",n,"\n"+"Message: ",t,"\n"+"================================\n");if(typeof e.debug!=="undefined"){e.debug(n)}}}if(t.extra&&t.extra.revision_web){this.checkRevision(t.extra.revision_web)}},this)};E.prototype.logMessage=function(e){if(!this.debug){return}if(e.extra.sender&&e.extra.sender.type===h.Client){console.info("onPullClientEvent-"+e.module_id,e.command,e.params,e.extra)}else if(e.moduleId=="online"){console.info("onPullOnlineEvent",e.command,e.params,e.extra)}else{console.info("onPullEvent",e.module_id,e.command,e.params,e.extra)}};E.prototype.onLongPollingOpen=function(){this.unloading=false;this.starting=false;this.connectionAttempt=0;this.isManualDisconnect=false;this.sendPullStatus(l.Online);if(this.offlineTimeout){clearTimeout(this.offlineTimeout);this.offlineTimeout=null}console.log(L.getDateForLog()+": Pull: Long polling connection with push-server opened");if(this.isWebSocketEnabled()){this.scheduleRestoreWebSocketConnection()}};E.prototype.onWebSocketBlockChanged=function(e){var t=e.isWebSocketBlocked;if(t&&this.connectionType===u.WebSocket&&!this.isConnected()){clearTimeout(this.reconnectTimeout);this.connectionAttempt=0;this.connectionType=u.LongPolling;this.scheduleReconnect(1)}else if(!t&&this.connectionType===u.LongPolling){clearTimeout(this.reconnectTimeout);clearTimeout(this.restoreWebSocketTimeout);this.connectionAttempt=0;this.connectionType=u.WebSocket;this.scheduleReconnect(1)}};E.prototype.onWebSocketOpen=function(){this.unloading=false;this.starting=false;this.connectionAttempt=0;this.isManualDisconnect=false;this.sendPullStatus(l.Online);this.sharedConfig.setWebSocketBlocked(false);if(this.connectionType==u.LongPolling){this.connectionType=u.WebSocket;this._connectors.longPolling.disconnect()}if(this.offlineTimeout){clearTimeout(this.offlineTimeout);this.offlineTimeout=null}console.log(L.getDateForLog()+": Pull: Websocket connection with push-server opened")};E.prototype.onWebSocketDisconnect=function(e){if(this.connectionType===u.WebSocket){if(e.code!=d.CONFIG_EXPIRED&&e.code!=d.CHANNEL_EXPIRED&&e.code!=d.CONFIG_REPLACED){this.sendPullStatus(l.Offline)}else{this.offlineTimeout=setTimeout(function(){this.sendPullStatus(l.Offline)}.bind(this),5e3)}}if(!e){e={}}console.log(L.getDateForLog()+": Pull: Websocket connection with push-server closed. Code: "+e.code+", reason: "+e.reason);if(!this.isManualDisconnect){this.scheduleReconnect()}this.isManualDisconnect=false};E.prototype.onWebSocketError=function(e){this.starting=false;if(this.connectionType===u.WebSocket){this.sendPullStatus(l.Offline)}console.error(L.getDateForLog()+": Pull: WebSocket connection error",e);this.scheduleReconnect()};E.prototype.onLongPollingDisconnect=function(e){if(this.connectionType===u.LongPolling){if(e.code!=d.CONFIG_EXPIRED&&e.code!=d.CHANNEL_EXPIRED&&e.code!=d.CONFIG_REPLACED){this.sendPullStatus(l.Offline)}else{this.offlineTimeout=setTimeout(function(){this.sendPullStatus(l.Offline)}.bind(this),5500)}}if(!e){e={}}console.log(L.getDateForLog()+": Pull: Long polling connection with push-server closed. Code: "+e.code+", reason: "+e.reason);if(!this.isManualDisconnect){this.scheduleReconnect()}this.isManualDisconnect=false};E.prototype.onLongPollingError=function(e){this.starting=false;if(this.connectionType===u.LongPolling){this.sendPullStatus(l.Offline)}console.error(L.getDateForLog()+": Pull: Long polling connection error",e);this.scheduleReconnect()};E.prototype.isConnected=function(){return this.connector?this.connector.connected:false};E.prototype.onBeforeUnload=function(){this.unloading=true;var e=L.clone(this.session);e.ttl=(new Date).getTime()+a*1e3;this.storage.set(c,JSON.stringify(e),a);this.reconnect(d.NORMAL_CLOSURE,"onbeforeunload",15)};E.prototype.onOffline=function(){this.disconnect("1000","offline")};E.prototype.onOnline=function(){this.connect()};E.prototype.handleInternalPullEvent=function(e,t){switch(e.toUpperCase()){case p.CHANNEL_EXPIRE:{if(t.params.action=="reconnect"){this.config.channels[t.params.channel.type]=t.params.new_channel;console.info("Pull: new config for "+t.params.channel.type+" channel set:\n",this.config.channels[t.params.channel.type]);this.reconnect(d.CONFIG_REPLACED,"config was replaced")}else{this.restart(d.CHANNEL_EXPIRED,"channel expired")}break}case p.CONFIG_EXPIRE:{this.restart(d.CONFIG_EXPIRED,"config expired");break}case p.SERVER_RESTART:{this.reconnect(d.SERVER_RESTARTED,"server was restarted",15);break}default:}};E.prototype.checkRevision=function(t){if(this.skipCheckRevision){return true}t=parseInt(t);if(t>0&&t!=n){this.enabled=false;if(typeof e.message!=="undefined"){this.showNotification(e.message("PULL_OLD_REVISION"))}this.disconnect(d.NORMAL_CLOSURE,"check_revision");if(typeof e.onCustomEvent!=="undefined"){e.onCustomEvent(window,"onPullRevisionUp",[t,n])}this.emit({type:f.Revision,data:{server:t,client:n}});console.log(L.getDateForLog()+": Pull revision changed from "+n+" to "+t+". Reload required");return false}return true};E.prototype.showNotification=function(t){var n=this;if(this.notificationPopup||typeof e.PopupWindow==="undefined")return;this.notificationPopup=new e.PopupWindow("bx-notifier-popup-confirm",null,{zIndex:200,autoHide:false,closeByEsc:false,overlay:true,content:e.create("div",{props:{className:"bx-messenger-confirm"},html:t}),buttons:[new e.PopupWindowButton({text:e.message("JS_CORE_WINDOW_CLOSE"),className:"popup-window-button-decline",events:{click:function(e){n.notificationPopup.close()}}})],events:{onPopupClose:function(){this.destroy()},onPopupDestroy:function(){n.notificationPopup=null}}});this.notificationPopup.show()};E.prototype.getRevision=function(){return this.config.api.revision_web};E.prototype.getServerVersion=function(){return this.config.server.version};E.prototype.getConfig=function(){return this.config};E.prototype.getDebugInfo=function(){if(!console||!console.info||!JSON||!JSON.stringify)return false;var e;if(this.config&&this.config.channels&&this.config.channels.private){e="ChannelID: "+this.config.channels.private.id+"\n"+"ChannelDie: "+this.config.channels.private.end+"\n"+"ChannelDieShared: "+this.config.channels.shared.end}else{e="Config error: config is not loaded"}var t=JSON.stringify(this.watchTagsQueue);var n="\n========= PULL DEBUG ===========\n"+"UserId: "+this.userId+" "+(this.userId>0?"":"(guest)")+"\n"+"Browser online: "+(navigator.onLine?"Y":"N")+"\n"+"Connect: "+(this.isConnected()?"Y":"N")+"\n"+"WebSocket support: "+(this.isWebSocketSupported()?"Y":"N")+"\n"+"WebSocket connect: "+(this._connectors.webSocket&&this._connectors.webSocket.connected?"Y":"N")+"\n"+"WebSocket mode: "+(this._connectors.webSocket&&this._connectors.webSocket.socket?this._connectors.webSocket.socket.url.search("binaryMode=true")!=-1?"protobuf":"text":"-")+"\n"+"Try connect: "+(this.reconnectTimeout?"Y":"N")+"\n"+"Try number: "+this.connectionAttempt+"\n"+"\n"+"Path: "+(this.connector?this.connector.path:"-")+"\n"+e+"\n"+"\n"+"Last message: "+(this.session.mid>0?this.session.mid:"-")+"\n"+"Session history: "+JSON.stringify(this.session.history)+"\n"+"Watch tags: "+(t=="{}"?"-":t)+"\n"+"================================\n";return console.info(n)};E.prototype.capturePullEvent=function(e){if(e===undefined){e=true}this.debug=e};E.prototype.getConnectionPath=function(e){var t;switch(e){case u.WebSocket:t=this.isSecure?this.config.server.websocket_secure:this.config.server.websocket;break;case u.LongPolling:t=this.isSecure?this.config.server.long_pooling_secure:this.config.server.long_polling;break;default:throw new Error("Unknown connection type "+e)}if(!L.isNotEmptyString(t)){return false}var o=[];["private","shared"].forEach(function(e){if(typeof this.config.channels[e]!=="undefined"){o.push(this.config.channels[e].id)}},this);if(o.length===0){return false}var i={CHANNEL_ID:o.join("/")};if(this.isProtobufSupported()){i.binaryMode="true"}if(this.session.mid){i.mid=this.session.mid}if(this.session.tag){i.tag=this.session.tag}if(this.session.time){i.time=this.session.time}i.revision=n;return t+"?"+L.buildQueryString(i)};E.prototype.getPublicationPath=function(){var e=this.isSecure?this.config.server.publish_secure:this.config.server.publish;if(!e){return""}var t=[];for(var n in this.config.channels){if(!this.config.channels.hasOwnProperty(n)){continue}t.push(this.config.channels[n].id)}var o={CHANNEL_ID:t.join("/")};return e+"?"+L.buildQueryString(o)};E.prototype.getConnectionAttemptDelay=function(e){var t;if(e<1){t=.5}else if(e<3){t=15}else if(e<5){t=45}else if(e<10){t=600}else{t=3600}return t+t*Math.random()*.2};E.prototype.sendPullStatus=function(t){if(this.unloading){return}if(typeof e.onCustomEvent!=="undefined"){e.onCustomEvent(window,"onPullStatus",[t])}this.emit({type:f.Status,data:{status:t}})};E.prototype.extendWatch=function(e,t){if(!e||this.watchTagsQueue[e]){return false}this.watchTagsQueue[e]=true;if(t){this.updateWatch(t)}};E.prototype.updateWatch=function(e){clearTimeout(this.watchUpdateTimeout);this.watchUpdateTimeout=setTimeout(function(){var e=Object.keys(this.watchTagsQueue);if(e.length>0){this.restClient.callMethod("pull.watch.extend",{tags:e}).then(function(e){var t=e.data();for(var n in t){if(t.hasOwnProperty(n)&&!t[n]){this.clearWatch(n)}}this.updateWatch()}.bind(this)).catch(function(){this.updateWatch()}.bind(this))}else{this.updateWatch()}}.bind(this),e?this.watchForceUpdateInterval:this.watchUpdateInterval)};E.prototype.clearWatch=function(e){delete this.watchTagsQueue[e]};E.prototype.setPrivateVar=function(){};E.prototype.returnPrivateVar=function(){};E.prototype.expireConfig=function(){};E.prototype.updateChannelID=function(){};E.prototype.tryConnect=function(){};E.prototype.tryConnectDelay=function(){};E.prototype.tryConnectSet=function(){};E.prototype.updateState=function(){};E.prototype.setUpdateStateStepCount=function(){};E.prototype.supportWebSocket=function(){return this.isWebSocketSupported()};E.prototype.isWebSoketConnected=function(){return this.isConnected()&&this.connectionType==u.WebSocket};E.prototype.getPullServerStatus=function(){return this.isConnected()};E.prototype.closeConfirm=function(){if(this.notificationPopup){this.notificationPopup.destroy()}};var C=function(e){e=e||{};this.storage=e.storage||new R;this.ttl=24*60*60;this.lsKeys={websocketBlocked:"bx-pull-websocket-blocked"};this.callbacks={onWebSocketBlockChanged:L.isFunction(e.onWebSocketBlockChanged)?e.onWebSocketBlockChanged:function(){}};window.addEventListener("storage",this.onLocalStorageSet.bind(this))};C.prototype.onLocalStorageSet=function(e){if(this.storage.compareKey(e.key,this.lsKeys.websocketBlocked)&&e.newValue!=e.oldValue){this.callbacks.onWebSocketBlockChanged({isWebSocketBlocked:this.isWebSocketBlocked()})}};C.prototype.isWebSocketBlocked=function(){return this.storage.get(this.lsKeys.websocketBlocked,0)>L.getTimestamp()};C.prototype.setWebSocketBlocked=function(e){this.storage.set(this.lsKeys.websocketBlocked,e?L.getTimestamp()+this.ttl:0)};var I=function(e,t){var n=function(){};n.prototype=t.prototype;e.prototype=new n;e.prototype.constructor=e;e.superclass=t.prototype;if(t.prototype.constructor==Object.prototype.constructor){t.prototype.constructor=t}};var w=function(e){this.parent=e.parent;this.callbacks={onOpen:L.isFunction(e.onOpen)?e.onOpen:function(){},onDisconnect:L.isFunction(e.onDisconnect)?e.onDisconnect:function(){},onError:L.isFunction(e.onError)?e.onError:function(){},onMessage:L.isFunction(e.onMessage)?e.onMessage:function(){}};this._connected=false;this.connectionType="";this.disconnectCode="";this.disconnectReason="";Object.defineProperty(this,"connected",{get:function(){return this._connected},set:function(e){if(e==this._connected)return;this._connected=e;if(this._connected){this.callbacks.onOpen()}else{this.callbacks.onDisconnect({code:this.disconnectCode,reason:this.disconnectReason})}}});Object.defineProperty(this,"path",{get:function(){return this.parent.getConnectionPath(this.connectionType)}})};var P=function(e){P.superclass.constructor.apply(this,arguments);this.connectionType=u.WebSocket;this.socket=null;this.onSocketOpenHandler=this.onSocketOpen.bind(this);this.onSocketCloseHandler=this.onSocketClose.bind(this);this.onSocketErrorHandler=this.onSocketError.bind(this);this.onSocketMessageHandler=this.onSocketMessage.bind(this)};I(P,w);P.prototype.connect=function(){if(this.socket){if(this.socket.readyState===1){return true}else{this.socket.removeEventListener("open",this.onSocketOpenHandler);this.socket.removeEventListener("close",this.onSocketCloseHandler);this.socket.removeEventListener("error",this.onSocketErrorHandler);this.socket.removeEventListener("message",this.onSocketMessageHandler);this.socket.close();this.socket=null}}this.createSocket()};P.prototype.disconnect=function(e,t){if(this.socket!==null){this.socket.removeEventListener("open",this.onSocketOpenHandler);this.socket.removeEventListener("close",this.onSocketCloseHandler);this.socket.removeEventListener("error",this.onSocketErrorHandler);this.socket.removeEventListener("message",this.onSocketMessageHandler);this.socket.close(e,t)}this.socket=null;this.disconnectCode=e;this.disconnectReason=t;this.connected=false};P.prototype.createSocket=function(){if(this.socket){throw new Error("Socket already exists")}if(!this.path){throw new Error("Websocket connection path is not defined")}this.socket=new WebSocket(this.path);this.socket.binaryType="arraybuffer";this.socket.addEventListener("open",this.onSocketOpenHandler);this.socket.addEventListener("close",this.onSocketCloseHandler);this.socket.addEventListener("error",this.onSocketErrorHandler);this.socket.addEventListener("message",this.onSocketMessageHandler)};P.prototype.send=function(e){if(!this.socket||this.socket.readyState!==1){console.error(L.getDateForLog()+": Pull: WebSocket is not connected");return false}this.socket.send(e)};P.prototype.onSocketOpen=function(){this.connected=true};P.prototype.onSocketClose=function(e){this.socket=null;this.disconnectCode=e.code;this.disconnectReason=e.reason;this.connected=false};P.prototype.onSocketError=function(e){this.callbacks.onError(e)};P.prototype.onSocketMessage=function(e){this.callbacks.onMessage(e.data)};P.prototype.destroy=function(){if(this.socket){this.socket.close();this.socket=null}};var T=function(e){T.superclass.constructor.apply(this,arguments);this.active=false;this.connectionType=u.LongPolling;this.requestTimeout=null;this.failureTimeout=null;this.xhr=this.createXhr();this.requestAborted=false};I(T,w);T.prototype.createXhr=function(){var e=new XMLHttpRequest;if(this.parent.isProtobufSupported()){e.responseType="arraybuffer"}e.addEventListener("readystatechange",this.onXhrReadyStateChange.bind(this));return e};T.prototype.connect=function(){this.active=true;this.performRequest()};T.prototype.disconnect=function(e,t){this.active=false;if(this.failureTimeout){clearTimeout(this.failureTimeout);this.failureTimeout=null}if(this.requestTimeout){clearTimeout(this.requestTimeout);this.requestTimeout=null}if(this.xhr){this.requestAborted=true;this.xhr.abort()}this.disconnectCode=e;this.disconnectReason=t;this.connected=false};T.prototype.performRequest=function(){var e=this;if(!this.active)return;if(!this.path){throw new Error("Long polling connection path is not defined")}if(this.xhr.readyState!==0&&this.xhr.readyState!==4){return}clearTimeout(this.failureTimeout);clearTimeout(this.requestTimeout);this.failureTimeout=setTimeout(function(){e.connected=true},5e3);this.requestTimeout=setTimeout(this.onRequestTimeout.bind(this),o*1e3);this.xhr.open("GET",this.path);this.xhr.send()};T.prototype.onRequestTimeout=function(){this.requestAborted=true;this.xhr.abort();this.performRequest()};T.prototype.onXhrReadyStateChange=function(e){if(this.xhr.readyState===4){if(!this.requestAborted||this.xhr.status==200){this.onResponse(this.xhr.response)}this.requestAborted=false}};T.prototype.send=function(e){var t=this.parent.getPublicationPath();if(!t){console.error(L.getDateForLog()+": Pull: publication path is empty");return false}var n=new XMLHttpRequest;n.open("POST",t);n.send(e)};T.prototype.onResponse=function(e){if(this.failureTimeout){clearTimeout(this.failureTimeout);this.failureTimeout=0}if(this.requestTimeout){clearTimeout(this.requestTimeout);this.requestTimeout=0}if(this.xhr.status==200){this.connected=true;if(L.isNotEmptyString(e)||e instanceof ArrayBuffer){this.callbacks.onMessage(e)}else{this.parent.session.mid=null}this.performRequest()}else if(this.xhr.status==304){this.connected=true;if(this.xhr.getResponseHeader("Expires")==="Thu, 01 Jan 1973 11:11:01 GMT"){var t=this.xhr.getResponseHeader("Last-Message-Id");if(L.isNotEmptyString(t)){this.parent.setLastMessageId(t)}}this.performRequest()}else{this.callbacks.onError("Could not connect to the server");this.connected=false}};var _=function(t){this.publicIds={};this.restClient=typeof t.restClient!=="undefined"?t.restClient:e.rest};_.prototype.getPublicIds=function(t){var n=new e.Promise;var o={};var i=new Date;var s=[];for(var r=0;r<t.length;r++){var c=t[r];if(this.publicIds[c]&&this.publicIds[c]["end"]>i){o[c]=this.publicIds[c]}else{s.push(c)}}if(s.length===0){n.resolve(o);return n}this.restClient.callMethod("pull.channel.public.list",{users:s}).then(function(e){var t=e.data();this.setPublicIds(L.objectValues(t));s.forEach(function(t){e[t]=this.publicIds[t]},this);n.resolve(e)}.bind(this));return n};_.prototype.setPublicIds=function(e){for(var t=0;t<e.length;t++){var n=e[t];var o=n.user_id;this.publicIds[o]={userId:o,publicId:n.public_id,signature:n.signature,start:new Date(n.start),end:new Date(n.end)}}};var R=function(t){t=t||{};this.userId=t.userId?t.userId:typeof e.message!=="undefined"&&e.message.USER_ID?e.message.USER_ID:0;this.siteId=t.siteId?t.siteId:typeof e.message!=="undefined"&&e.message.SITE_ID?e.message.SITE_ID:"none"};R.prototype.set=function(e,t){if(typeof window.localStorage==="undefined"){return false}if(typeof t!="string"){if(t){t=JSON.stringify(t)}}return window.localStorage.setItem(this.getKey(e),t)};R.prototype.get=function(e,t){if(typeof window.localStorage==="undefined"){return t||null}var n=window.localStorage.getItem(this.getKey(e));if(n===null){return t||null}return JSON.parse(n)};R.prototype.remove=function(e){if(typeof window.localStorage==="undefined"){return false}return window.localStorage.removeItem(this.getKey(e))};R.prototype.getKey=function(e){return"bx-pull-"+this.userId+"-"+this.siteId+"-"+e};R.prototype.compareKey=function(e,t){return e===this.getKey(t)};var L={browser:{IsChrome:function(){return navigator.userAgent.toLowerCase().indexOf("chrome")!=-1},IsFirefox:function(){return navigator.userAgent.toLowerCase().indexOf("firefox")!=-1},IsIe:function(){return navigator.userAgent.match(/(Trident\/|MSIE\/)/)!==null}},getTimestamp:function(){return(new Date).getTime()},errorsToString:function(e){if(!this.isArray(e)){return""}else{return e.reduce(function(e,t){if(e!=""){e+="; "}return e+t.code+": "+t.message},"")}},isString:function(e){return e===""?true:e?typeof e=="string"||e instanceof String:false},isArray:function(e){return e&&Object.prototype.toString.call(e)=="[object Array]"},isFunction:function(e){return e===null?false:typeof e=="function"||e instanceof Function},isDomNode:function(e){return e&&typeof e=="object"&&"nodeType"in e},isDate:function(e){return e&&Object.prototype.toString.call(e)=="[object Date]"},isPlainObject:function(e){if(!e||typeof e!=="object"||e.nodeType){return false}var t=Object.prototype.hasOwnProperty;try{if(e.constructor&&!t.call(e,"constructor")&&!t.call(e.constructor.prototype,"isPrototypeOf")){return false}}catch(e){return false}var n;for(n in e){}return typeof n==="undefined"||t.call(e,n)},isNotEmptyString:function(e){return this.isString(e)?e.length>0:false},buildQueryString:function(e){var t="";for(var n in e){if(!e.hasOwnProperty(n)){continue}var o=e[n];if(L.isArray(o)){o.forEach(function(e,o){t+=encodeURIComponent(n+"["+o+"]")+"="+encodeURIComponent(e)+"&"})}else{t+=encodeURIComponent(n)+"="+encodeURIComponent(o)+"&"}}if(t.length>0){t=t.substr(0,t.length-1)}return t},objectValues:function e(t){var n=[];for(var o in t){if(t.hasOwnProperty(o)&&t.propertyIsEnumerable(o)){n.push(t[o])}}return n},clone:function(e,t){var n,o,i;if(t!==false)t=true;if(e===null)return null;if(this.isDomNode(e)){n=e.cloneNode(t)}else if(typeof e=="object"){if(this.isArray(e)){n=[];for(o=0,i=e.length;o<i;o++){if(typeof e[o]=="object"&&t)n[o]=this.clone(e[o],t);else n[o]=e[o]}}else{n={};if(e.constructor){if(this.isDate(e))n=new Date(e);else n=new e.constructor}for(o in e){if(!e.hasOwnProperty(o)){continue}if(typeof e[o]=="object"&&t)n[o]=this.clone(e[o],t);else n[o]=e[o]}}}else{n=e}return n},getDateForLog:function(){var e=new Date;return e.getFullYear()+"-"+L.lpad(e.getMonth(),2,"0")+"-"+L.lpad(e.getDate(),2,"0")+" "+L.lpad(e.getHours(),2,"0")+":"+L.lpad(e.getMinutes(),2,"0")},lpad:function(e,t,n){e=e.toString();n=n||" ";if(e.length>t){return e}var o="";for(var i=0;i<t-e.length;i++){o+=n}return o+e}};if(typeof e.namespace!=="undefined"&&typeof e.PULL==="undefined"){e.PULL=new E}e.PullClient=E;e.PullClient.PullStatus=l;e.PullClient.SubscriptionType=f;e.PullClient.CloseReasons=d})();
/* End */
;
//# sourceMappingURL=kernel_pull.map.js